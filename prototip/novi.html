<!--Napravio: Aleksa Funduk 2014/0219-->

<!--
<?php
	include 'config.php';

	//save url to redirect when login
	$_SESSION['url'] = $_SERVER['REQUEST_URI'];

	// Check if the user is logged in
	if(!isSet($_SESSION['username'])) {
		header("Location: login.php");
		exit;
	}
?>-->
<!DOCTYPE html>
<html>
<head>
	<title>Lemon squeezy - Novi oglas</title>
	<style type="text/css">
		body {
			padding: 0;
			margin: 0;
			font-family: arial;
			background-color: gray;
			font-size: 14px;
		}
		#upload-container {
			display: inline-block;
			width: 320px;
			height: 30px;
		    -webkit-box-shadow: inset 0px 0px 0px 0px gray, inset 0px -4px 0px 0px darkgray;
			-moz-box-shadow: inset 0px 0px 0px 0px gray, inset 0px -4px 0px 0px darkgray;
			box-shadow: inset 0px 0px 0px 0px gray, inset 0px -4px 0px 0px darkgray;
			border-radius: 10px;
			position: relative;
			background-color: lightgray;
		}
		#upload-container #text {
			position: absolute;
			font-family: arial;
			font-size: 14px;
			display: block;
			margin: 0;
			top: 5px;
			left: 25%;
			transform: translateX(-50%);
		}
		#browse {
			width: 80px;
			height: 100%;
			right: 0;
			top: 0;
			background-color: orange;
			-webkit-box-shadow: inset 0px -4px 0px 0px darkorange;
			-moz-box-shadow: inset 0px -4px 0px 0px darkorange;
			box-shadow: inset 0px -4px 0px 0px darkorange;
			position: absolute;
			border-radius: 0px 10px 10px 0px;
			cursor: pointer;
			-webkit-touch-callout: none; 
			-webkit-user-select: none;   
			-khtml-user-select: none;    
			-moz-user-select: none;     
			-ms-user-select: none;
			user-select: none;   
		}
		#clear {
			width: 80px;
			height: 100%;
			right: 80px;
			top: 0;
			background-color: gray;
			-webkit-box-shadow: inset 0px -4px 0px 0px dimgray;
			-moz-box-shadow: inset 0px -4px 0px 0px dimgray;
			box-shadow: inset 0px -4px 0px 0px dimgray;
			position: absolute;
			cursor: pointer;
			-webkit-touch-callout: none; 
			-webkit-user-select: none;   
			-khtml-user-select: none;    
			-moz-user-select: none;     
			-ms-user-select: none;
			user-select: none; 
		}
		#browse:hover {
			background-color: #ffb52d;
			-webkit-box-shadow: inset 0px -4px 0px 0px orange;
			-moz-box-shadow: inset 0px -4px 0px 0px orange;
			box-shadow: inset 0px -4px 0px 0px orange;
		}
		#clear:hover {
			background-color: #8e8e8e;
			-webkit-box-shadow: inset 0px -4px 0px 0px gray;
			-moz-box-shadow: inset 0px -4px 0px 0px gray;
			box-shadow: inset 0px -4px 0px 0px gray;
		}
		#browse:active {
			-webkit-box-shadow: inset 0px -2px 0px 0px darkorange;
			-moz-box-shadow: inset 0px -2px 0px 0px darkorange;
			box-shadow: inset 0px -2px 0px 0px darkorange;
		}
		#clear:active {
			-webkit-box-shadow: inset 0px -2px 0px 0px dimgray;
			-moz-box-shadow: inset 0px -2px 0px 0px dimgray;
			box-shadow: inset 0px -2px 0px 0px dimgray;
		}
		#browse:active p, #clear:active p {
			margin-top: 6px;
		}
		#browse p, #clear p {
			color: white;
			font-family: arial black;
			margin-top: 4px;
			font-size: 13px;
		}
		#upload-container img {
			display: inline-block;
		}
		#browse input[type=file] {
        	display: none;
		}
		#browse label {
			position: absolute;
			left: 0;
			top: 0;
			min-width: 100%;
			min-height: 100%;
			cursor: pointer;
			filter: alpha(opacity=0);
			opacity: 0;
			min-width: 100%;
        	min-height: 100%;
        	border-radius: 0px 10px 10px 0px;
		}
		#wrapper {
			background-color: white;
			position: absolute;
			left: 50%;
			top: 50%;
			border-radius: 10px;
			transform: translate(-50%, -50%);
			text-align: center;
			padding-left: 10px;
			padding-right: 10px;
			padding-bottom: 5px;
		}
		#date a {
			color: gray;
			font-weight: bolder;
			text-decoration: none;
		}
		#date a:hover {
			color: black;
			text-decoration: underline;
		}
		input, textarea {
			border: 1px solid gray;
		}
	</style>
</head>
<body>
	<div style="background-color: white; border-radius: 10px; display: inline-block; padding: 10px; margin: 10px"><div id="date">&laquo; <a href="./index.html">Glavna</a></div></div>
	<div style="background-color: white; border-radius: 10px; display: inline-block; padding: 10px; position: absolute; top: 10px; right: 10px">
		<span>Aleksa Funduk</span>&nbsp;&nbsp;-&nbsp;
		&nbsp;<a href="./nalog.html"><button>Moj nalog</button></a>&nbsp;<a href="./index.html"><button>Odjava</button></a>
	</div>
	<div id="wrapper">
		<h2 style="margin: 0; margin-top: 15px;">Novi oglas</h2>
		<hr style="margin-left: 5%;margin-right: 5%; margin-top: 10px; margin-bottom: 0"><br>
		<form method="post" action="<?=$_SERVER['PHP_SELF']?>" enctype="multipart/form-data">
			<table style="text-align: left; margin: 0 auto;display: inline-block;">
				<tr>
					<td>
						Naziv oglasa*:
					</td>
					<td>
						<input id="naziv" type="text" size="48" name="naziv" placeholder=" npr. Novi stan u Beogradu..." autocomplete="off" required></input>
					</td>
				</tr>
				<td>Tip*:</td>
					<td>
						<select name="tip-nekretnine" style="width: 150px">
							<option value="Stambeni">Stambeni objekat</option>
							<option value="Poslovni">Poslovni objekat</option>
							<option value="Zemljiste">Zemljiste</option>
							<option value="Skladiste">Skladiste</option>
						</select>
					</td>
				<tr>
					<td>
						Lokacija*:
					</td>
					<td>
						<input type="text" size="30"  placeholder=" npr. Beograd, Novi Sad..." name="lokacija" required></input>
					</td>
				</tr>
				<tr>
					<td>
						Cena(din)*:
					</td>
					<td>
						<input type="number" min="1" name="cena" placeholder=" npr. 30000" onkeypress="return isNumber(event)" required></input>
					</td>
				</tr>
				<tr>
					<td>
						Kvadratura(m<sup style="font-size: 10px">2</sup>)*:
					</td>
					<td>
						<input type="number" min="1" name="kvadratura" placeholder=" npr. 99" onkeypress="return isNumber(event)" required></input>
					</td>
				</tr>
				<tr>
					<td>Broj soba*:</td>
					<td><input type="number" placeholder=" npr. 3" min="1" required></input></td> 
				</tr>
				<tr>
					<td>Nameštenost*:</td>
					<td>
						<select name="namestenost" style="width: 120px">
							<option value="namesten">Namešten</option>
							<option value="polunamesten">Polunamešten</option>
							<option value="nenamesten">Nenamešten</option>
						</select>
					</td> 
				</tr>
				<tr>
					<td>Grejanje*:</td>
					<td>
						<select name="grenjanje" style="width: 120px">
							<option value="centralno">Centralno</option>
							<option value="gas">Gas</option>
							<option value="elektricno">Električno</option>
							<option value="etazno">Etažno</option>
						</select>
					</td>
				</tr>
				<tr>
					<td>Ljubimci*:</td>
					<td>
						<select name="ljubimci" style="width: 120px">
							<option value="zabranjeni">Zabranjeni</option>
							<option value="dozvoljeni">Dozvoljeni</option>
						</select>
					</td>
				</tr>
			</table>
			<hr style="margin-left: 5%;margin-right: 5%;">
			<table style="text-align: left; margin: 0 auto;" >
				<tr>
					<td><label><input type="checkbox" name="cellar" class="radio" value="1">Podrum</label></td>
					<td><label><input type="checkbox" name="phone" class="radio" value="1">Telefon</label></td>
					<td><label><input type="checkbox" name="parking" class="radio" value="1">Parking</label></td>
					<td><label><input type="checkbox" name="air_condition" class="radio" value="1">Klima</label></td>
					<td><label><input type="checkbox" name="terrace" class="radio" value="1">Terasa</label></td>
					<td><label><input type="checkbox" name="cable" class="radio" value="1">Kablovska</label></td>	
					<td><label><input type="checkbox" name="internet" class="radio" value="1">Internet&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label></td>
				</tr>
				<tr>
					<td><label><input type="checkbox" name="garage" class="radio" value="1">Garaža</label></td>
					<td><label><input type="checkbox" name="lift" class="radio" value="1">Lift</label></td>
					<td><label><input type="checkbox" name="pool" class="radio" value="1">Bazen</label></td>
					<td><label><input type="checkbox" name="cable" class="radio" value="1">Alarm</label></td>	
					<td><label><input type="checkbox" name="yard" class="radio" value="1">Dvorište</label> </td>
					<td><label><input type="checkbox" name="in_construction" class="radio" value="1">U izgradnji</label></td>
					<td><label><input type="checkbox" name="recent" class="radio" value="1">Novogradnja</label></td>
				</tr>			
			</table>
			<hr style="margin-left: 5%;margin-right: 5%; margin-top: 10px;">
			<center>
				<table>
					<tr>
						<td>
							Okači slike:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
						</td>
						<td style="text-align: center;">
							<div id="upload-container">
								<p id="text">Nema izabranih slika.</p>
								<div id="browse">
									<p>Nadji <img src="./images/foldericon.png" height="10"></p>
									<label for="upload"></label>
									<input id="upload" type="file" name="files[]" multiple="multiple" accept="image/*" onchange="filenumber()">
								</div>
								<div id="clear" onclick="clearfiles('upload')">
									<p>Obriši <img src="./images/trashcanicon.png" height="11"></p>
								</div>
							</div>
						</td>
					</tr>
				</table>
			</center>
			<hr style="margin-left: 5%;margin-right: 5%; margin-bottom: 10px;">
			<label><input type="checkbox" name="sale" class="radio" value="1">Popust</label>
			<input type="number" placeholder=" Koliko?" min="1" style="width: 70px"></input>
			<input type="text" placeholder=" Razlog (npr. popust za studente...)" size="40"></input>
			<hr style="margin-left: 5%;margin-right: 5%; margin-top: 10px;">
			<table style="text-align: left; margin: 0 auto;">
				<tr>
					<td>Opis:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
					<td><textarea cols="48" rows="6"></textarea></td>
				</tr>
			</table>
			<hr style="margin-left: 5%;margin-right: 5%; margin-bottom: 10px;">
			<input type="reset" value="Obriši">
			<input type="submit" name="submit" value="Postavi"></input>
		</form>
	</div>
	<script type="text/javascript">
		// dopusta samo brojeve (za kvadraturu i cenu)
		function isNumber(evt) {
			evt = (evt) ? evt : window.event;
			var charCode = (evt.which) ? evt.which : evt.keyCode;
			if (charCode > 31 && (charCode < 48 || charCode > 57)) {
				return false;
			}
			return true;
		}
		function clearfiles(target) {
			var f = document.getElementById(target);
			if(f.value){
                f.value = '';
        		if(f.value){
            		var form = document.createElement('form'),
                	parentNode = f.parentNode, ref = f.nextSibling;
            		form.appendChild(f);
            		form.reset();
            		parentNode.insertBefore(f,ref);
        		}
    		}
    		document.getElementById('text').innerHTML = "Nema izabranih slika.";
		}
		function filenumber() {
			var num = document.getElementById('upload').files.length;
			if (num == 1) {
				document.getElementById('text').innerHTML = num + " slika.";
			}
			else {
				document.getElementById('text').innerHTML = num + " slike.";
			}
		}
	</script>
<!--
<?php
	function check_extension($file) {
		$allowed =  array('gif','png' ,'jpg', 'jpeg');
		$ext = pathinfo($file, PATHINFO_EXTENSION);
		if(!in_array($ext,$allowed)) return false;
		else return true;
	}
	function image_resize_compress($img_src, $folder_dest, $max_width, $max_height, $compression) {
		$info = getimagesize($img_src);

		if ($info['mime'] == 'image/jpeg') $image = imagecreatefromjpeg($img_src);
		elseif ($info['mime'] == 'image/gif') $image = imagecreatefromgif($img_src);
		elseif ($info['mime'] == 'image/png') $image = imagecreatefrompng($img_src);

		unlink($img_src);

		$dst = $folder_dest."/";
		$dst .= bin2hex(openssl_random_pseudo_bytes(12)).".jpg";

		$old_width = imagesx($image);
		$old_height = imagesy($image);
		if ($old_width > $max_width || $old_height > $old_height) {
			$scale = min($max_width/$old_width, $max_height/$old_height);
			$new_width = ceil($scale*$old_width);
			$new_height = ceil($scale*$old_height);

			$new_image = imagecreatetruecolor($new_width, $new_height);

			imagecopyresampled($new_image, $image, 0, 0, 0, 0, $new_width, $new_height, $old_width, $old_height);

			imagejpeg($new_image, $dst, $compression);

			imagedestroy($new_image);

		} else imagejpeg($image, $dst, $compression);

		imagedestroy($image);
	}

	if(isset($_POST['submit'])) {

		$title = $_POST['naziv'];
		$location = $_POST['lokacija'];
		$price = $_POST['cena'];
		$area = $_POST['kvadratura'];
		$description = $_POST['opis'];
		$keywords = $_POST['keywords'];

		$title = trim($title);

		$sql1 = "SELECT title FROM ad WHERE title = '$title'"; // bolje ako je oglas skroz isti
	
		$sql2 = "INSERT INTO ad (title, description, keywords, location, price, area) VALUES ('$title', '$description', '$keywords', '$location', '$price', '$area')";

		$conn = mysqli_connect('localhost', 'root', '', 'baza');
		if (!$conn) die("Connection failed: " . mysqli_connect_error()); 

		mysqli_autocommit($conn, false);

		$result1 = mysqli_query($conn, $sql1);

		if (mysqli_num_rows($result1) > 0) {
			mysqli_commit($conn);

			echo "Vec postoji oglas!\n";

			// oglas sa datim imenom vec postoji 
		}
		else {
			$result2 = mysqli_query($conn, $sql2);
			if ($result1 && $result2) {
				mysqli_commit($conn);

				$title = str_replace(' ', '_', $title);
				mkdir("../oglasi/$title");
				mkdir("../oglasi/$title/slike");

				//image upload
				$n = count(array_filter($_FILES['files']['name']));
				echo "Broj fajlova: $n<br>";
				if ($n > 0) {
					for ($i = 0; $i < $n; $i++) {
						$filename = $_FILES['files']['name'][$i];
						if (move_uploaded_file($_FILES['files']['tmp_name'][$i], "uploads/$filename")) {
							echo "Uspesan upload<br>";
							image_resize_compress("uploads/$filename", "../oglasi/$title/slike", 1920, 1080, 90);
            			} else {
               				echo '<span id="error">please try again!.</span><br/><br/>';
            			}
					}
				}
				else {
					//use default image
				}

				$file = fopen("../oglasi/$title/index.php", "w");

				//napraviti izgled stranice oglasa fwrite();

				fclose($file);

				echo "Uspesno napravljen oglas!\n";

				//uspesno napravljen oglas (popup - da li zelite da odete na stranicu oglasa ili ostani ovde ili nazad na glavnu)
			}
			else {
				mysqli_rollback($conn);
				
				//neuspesno pravljenje oglasa (popup - sacekajte 1min i porbajte ponovo) 
			}
		}
		mysqli_close($conn);
	}
?>
-->
</body>
</html>